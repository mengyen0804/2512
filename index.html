<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ—©é¤é»é¤ç³»çµ± 4.0</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #FFF8E1;
      font-family: 'Noto Sans TC', sans-serif;
    }
    #donut {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 4rem;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }
  </style>
</head>
<body class="p-4">
  <h1 class="text-3xl mb-4">ğŸ¥ æ—©é¤é»é¤ç³»çµ± 4.0</h1>

  <div class="mb-4">
    <label class="block text-lg mb-2">è¨‚è³¼äººå§“åï¼š</label>
    <input id="customer" type="text" class="border p-2 rounded w-full" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
  </div>

  <div class="mb-4">
    <label class="block text-lg mb-2">å‚™è¨»ï¼š</label>
    <input id="note" type="text" class="border p-2 rounded w-full" placeholder="ä¾‹å¦‚ï¼šä¸è¦è¾£ã€é†¬å°‘ä¸€é»...">
  </div>

  <div class="mb-4">
    <label class="block text-lg mb-2">ç”¨é¤æ–¹å¼ï¼š</label>
    <select id="dineOption" class="border p-2 rounded w-full">
      <option value="å…§ç”¨">å…§ç”¨</option>
      <option value="å¤–å¸¶">å¤–å¸¶</option>
    </select>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <h2 class="text-xl mb-2">èœå–®</h2>
      <ul id="menu" class="space-y-2 max-h-[70vh] overflow-y-auto pr-2"></ul>
    </div>
    <div>
      <h2 class="text-xl mb-2">å·²é»é¤é»</h2>
      <ul id="order" class="space-y-2 mb-4 max-h-[50vh] overflow-y-auto pr-2"></ul>
      <div class="text-lg mb-2">ç¸½é‡‘é¡ï¼š<span id="total">0</span> å…ƒ</div>

      <div class="mb-2">
        <label class="block mb-1">å®¢äººä»˜æ¬¾é‡‘é¡ï¼š</label>
        <input id="paid" type="number" class="border p-2 rounded w-full" placeholder="è¼¸å…¥é‡‘é¡">
        <div class="mt-1">æ‰¾é›¶ï¼š<span id="change">0</span> å…ƒ</div>
      </div>

      <button id="checkout" class="mt-4 bg-yellow-400 px-4 py-2 rounded shadow hover:bg-yellow-300">çµå¸³</button>

      <div id="receipt" class="mt-4 p-4 bg-white rounded shadow hidden whitespace-pre-wrap"></div>
    </div>
  </div>

  <div id="donut">ğŸ©</div>

  <script>
    const menu = document.getElementById('menu');
    const order = document.getElementById('order');
    const total = document.getElementById('total');
    const customer = document.getElementById('customer');
    const note = document.getElementById('note');
    const paid = document.getElementById('paid');
    const change = document.getElementById('change');
    const dineOption = document.getElementById('dineOption');
    const receipt = document.getElementById('receipt');
    const donut = document.getElementById('donut');
    let orderList = [];

    const items = [
      { name: 'è‰è“åå¸', price: 20 }, { name: 'å¥¶æ²¹åå¸', price: 20 }, { name: 'èŠ±ç”Ÿåå¸', price: 20 },
      { name: 'å·§å…‹åŠ›åå¸', price: 20 }, { name: 'åå¸å¤¾è›‹', price: 30 }, { name: 'ç«è…¿è›‹åå¸', price: 40 },
      { name: 'é®ªé­šè›‹åå¸', price: 45 }, { name: 'è‚‰é¬†è›‹åå¸', price: 45 }, { name: 'æ³•åœ‹åå¸', price: 50 },
      { name: 'æ¼¢å ¡è‚‰å¤¾è›‹åå¸', price: 50 }, { name: 'èŠ±ç”Ÿåšç‰‡', price: 35 }, { name: 'è‰è“åšç‰‡', price: 35 },
      { name: 'å¥¶æ²¹åšç‰‡', price: 35 }, { name: 'å·§å…‹åŠ›åšç‰‡', price: 35 }, { name: 'å¥¶é…¥åšç‰‡', price: 40 },
      { name: 'è’œå‘³åšç‰‡', price: 40 }, { name: 'èµ·å¸åšç‰‡', price: 40 }, { name: 'é®ªé­šåšç‰‡', price: 45 },
      { name: 'ç‰¹è£½ç´ é£Ÿé£¯ç³°', price: 45 }, { name: 'ç‰¹è£½ç´«ç±³é£¯ç³°', price: 50 }, { name: 'æ‹›ç‰Œç´«ç±³ç‡’è‚‰é£¯ç³°', price: 65 },
      { name: 'å…¨éº¥ç´ ä¸‰æ˜æ²»', price: 30 }, { name: 'è‚‰é¬†ä¸‰æ˜æ²»', price: 30 }, { name: 'é®ªé­šä¸‰æ˜æ²»', price: 30 },
      { name: 'ç«è…¿ä¸‰æ˜æ²»', price: 30 }, { name: 'èµ·å¸æ°´æœä¸‰æ˜æ²»', price: 55 }, { name: 'é®ªé­šç¸½åŒ¯ä¸‰æ˜æ²»', price: 55 },
      { name: 'æ‹›ç‰Œç‡’è‚‰ç¸½åŒ¯ä¸‰æ˜æ²»', price: 60 }, { name: 'å¤æ—©å‘³è˜¿è””ç³•', price: 35 }, { name: 'åŸå‘³è›‹é¤…', price: 30 },
      { name: 'é’è”¥è›‹é¤…', price: 35 }, { name: 'èŠéº»è›‹é¤…', price: 40 }, { name: 'ç«è…¿è›‹é¤…', price: 40 },
      { name: 'è‚‰é¬†è›‹é¤…', price: 45 }, { name: 'é®ªé­šè›‹é¤…', price: 45 }, { name: 'èµ·å¸è›‹é¤…', price: 45 },
      { name: 'è”¬èœè›‹é¤…', price: 45 }, { name: 'ç‰ç±³è›‹é¤…', price: 45 }, { name: 'åŸ¹æ ¹è›‹é¤…', price: 50 },
      { name: 'æ‹›ç‰Œç‡’è‚‰è›‹é¤…', price: 60 }, { name: 'ç´…èŒ¶å°', price: 20 }, { name: 'ç´…èŒ¶å¤§', price: 40 },
      { name: 'ç´…èŒ¶è±†æ¼¿å°', price: 20 }, { name: 'ç´…èŒ¶è±†æ¼¿å¤§', price: 40 }, { name: 'é¤Šç”Ÿé»ƒè±†æ¼¿å°', price: 20 },
      { name: 'é¤Šç”Ÿé»ƒè±†æ¼¿å¤§', price: 40 }, { name: 'é¤Šç”Ÿé»‘è±†æ¼¿å°', price: 25 }, { name: 'é¤Šç”Ÿé»‘è±†æ¼¿å¤§', price: 50 },
      { name: 'å±±è—¥äº”ç©€ç±³æ¼¿å°', price: 25 }, { name: 'å±±è—¥äº”ç©€ç±³æ¼¿å¤§', price: 50 }, { name: 'é®®å¥¶ç´…èŒ¶å°', price: 25 },
      { name: 'é®®å¥¶ç´…èŒ¶å¤§', price: 50 }, { name: 'å’–å•¡ç‰›å¥¶å°', price: 40 }, { name: 'å’–å•¡ç‰›å¥¶å¤§', price: 80 }
    ];

    items.forEach(item => {
      const li = document.createElement('li');
      li.innerHTML = `<div class="flex items-center justify-between bg-yellow-100 p-2 rounded shadow">
        <span>${item.name} - $${item.price}</span>
        <div class="flex items-center space-x-2">
          <button onclick="decreaseItem('${item.name}')" class="bg-red-300 px-2 rounded">-</button>
          <span id="qty-${item.name}">0</span>
          <button onclick="addItem('${item.name}', ${item.price})" class="bg-green-300 px-2 rounded">+</button>
        </div>
      </div>`;
      menu.appendChild(li);
    });

    function addItem(name, price) {
      const existing = orderList.find(i => i.name === name);
      if (existing) {
        existing.qty++;
      } else {
        orderList.push({ name, price, qty: 1 });
      }
      renderOrder();
    }

    function decreaseItem(name) {
      const existing = orderList.find(i => i.name === name);
      if (existing) {
        existing.qty--;
        if (existing.qty <= 0) {
          orderList = orderList.filter(i => i.name !== name);
        }
        renderOrder();
      }
    }

    function renderOrder() {
      order.innerHTML = '';
      let sum = 0;
      orderList.forEach(item => {
        const li = document.createElement('li');
        li.textContent = `${item.name} x ${item.qty} - $${item.price * item.qty}`;
        order.appendChild(li);
        sum += item.price * item.qty;
        document.getElementById(`qty-${item.name}`).textContent = item.qty;
      });
      total.textContent = sum;
      const paidAmount = parseInt(paid.value) || 0;
      change.textContent = paidAmount >= sum ? paidAmount - sum : 0;
    }

    paid.addEventListener('input', () => {
      const sum = parseInt(total.textContent);
      const paidAmount = parseInt(paid.value) || 0;
      change.textContent = paidAmount >= sum ? paidAmount - sum : 0;
    });

    async function sendToSheet(data) {
      try {
        await fetch('https://sheet-api-demo.monday-helper.workers.dev/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
      } catch (e) {
        console.error('ç„¡æ³•å‚³é€åˆ° Google Sheet', e);
      }
    }

    document.getElementById('checkout').addEventListener('click', async () => {
      if (orderList.length === 0) {
        alert('ä½ é‚„æ²’é»ä»»ä½•æ±è¥¿å–”ï¼');
        return;
      }
      if (customer.value.trim() === '') {
        alert('è«‹è¼¸å…¥è¨‚è³¼äººå§“å');
        return;
      }

      const summary = orderList.map(i => `${i.name} x ${i.qty} - $${i.price * i.qty}`).join('\n');
      const sum = parseInt(total.textContent);
      const paidAmount = parseInt(paid.value) || 0;
      const changeAmount = paidAmount >= sum ? paidAmount - sum : 0;
      const data = {
        timestamp: new Date().toLocaleString(),
        customer: customer.value,
        dineOption: dineOption.value,
        note: note.value || 'ç„¡',
        order: summary,
        total: sum,
        paid: paidAmount,
        change: changeAmount
      };

      donut.style.display = 'block';
      await sendToSheet(data);
      donut.style.display = 'none';

      const receiptText = `ğŸ§¾ æ”¶æ“š\n-------------------\nè¨‚è³¼äººï¼š${data.customer}\nç”¨é¤æ–¹å¼ï¼š${data.dineOption}\nå‚™è¨»ï¼š${data.note}\n\nè¨‚å–®å…§å®¹ï¼š\n${summary}\n\nç¸½é‡‘é¡ï¼š$${sum}\nä»˜æ¬¾é‡‘é¡ï¼š$${paidAmount}\næ‰¾é›¶ï¼š$${changeAmount}\n-------------------\nğŸ© æ„Ÿè¬æ‚¨çš„è¨‚è³¼ï¼`;
      receipt.textContent = receiptText;
      receipt.classList.remove('hidden');

      orderList = [];
      customer.value = '';
      note.value = '';
      paid.value = '';
      change.textContent = '0';
      items.forEach(i => document.getElementById(`qty-${i.name}`).textContent = '0');
      renderOrder();
    });
  </script>
</body>
</html>
